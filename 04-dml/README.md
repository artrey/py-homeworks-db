# Домашнее задание к лекции «Продвинутая выборка данных»

## Задание 1

Продолжаем работать со своей базой данных. В этом задании заполните базу данных из домашнего задания к занятию "Работа с SQL. Создание БД". В ней должно быть:

- не менее 4 исполнителей,
- не менее 3 жанров,
- не менее 3 альбомов,
- не менее 6 треков,
- не менее 4 сборников.

Внимание: должны быть заполнены все поля каждой таблицы, в том числе таблицы связей исполнителей с жанрами, исполнителей с альбомами, сборников с треками.

## Ответ 1

CREATE TABLE Исполнители (
    Идентификатор INT PRIMARY KEY,
    Имя VARCHAR(255)
);

CREATE TABLE Жанры (
    Идентификатор INT PRIMARY KEY,
    Название VARCHAR(255)
);

CREATE TABLE Альбомы (
    Идентификатор INT PRIMARY KEY,
    Название VARCHAR(255),
    Год_выпуска INT
);

CREATE TABLE Треки (
    Идентификатор INT PRIMARY KEY,
    Название VARCHAR(255),
    Идентификатор_альбома INT,
    FOREIGN KEY (Идентификатор_альбома) REFERENCES Альбомы(Идентификатор)
);

CREATE TABLE Сборники (
    Идентификатор INT PRIMARY KEY,
    Название VARCHAR(255),
    Год_выпуска INT
);

CREATE TABLE Исполнители_Жанры (
    Идентификатор INT PRIMARY KEY,
    Идентификатор_исполнителя INT,
    Идентификатор_жанра INT,
    FOREIGN KEY (Идентификатор_исполнителя) REFERENCES Исполнители(Идентификатор),
    FOREIGN KEY (Идентификатор_жанра) REFERENCES Жанры(Идентификатор)
);

CREATE TABLE Исполнители_Альбомы (
    Идентификатор INT PRIMARY KEY,
    Идентификатор_исполнителя INT,
    Идентификатор_альбома INT,
    FOREIGN KEY (Идентификатор_исполнителя) REFERENCES Исполнители(Идентификатор),
    FOREIGN KEY (Идентификатор_альбома) REFERENCES Альбомы(Идентификатор)
);

CREATE TABLE Альбомы_Треки (
    Идентификатор INT PRIMARY KEY,
    Идентификатор_альбома INT,
    Идентификатор_трека INT,
    FOREIGN KEY (Идентификатор_альбома) REFERENCES Альбомы(Идентификатор),
    FOREIGN KEY (Идентификатор_трека) REFERENCES Треки(Идентификатор)
);

CREATE TABLE Сборники_Треки (
    Идентификатор INT PRIMARY KEY,
    Идентификатор_сборника INT,
    Идентификатор_трека INT,
    FOREIGN KEY (Идентификатор_сборника) REFERENCES Сборники(Идентификатор),
    FOREIGN KEY (Идентификатор_трека) REFERENCES Треки(Идентификатор)
);

## Задание 2

Написать SELECT-запросы, которые выведут информацию согласно инструкциям ниже.

Внимание: результаты запросов не должны быть пустыми, учтите это при заполнении таблиц.

1. Название и продолжительность самого длительного трека.
2. Название треков, продолжительность которых не менее 3,5 минут.
3. Названия сборников, вышедших в период с 2018 по 2020 год включительно.
4. Исполнители, чьё имя состоит из одного слова.
5. Название треков, которые содержат слово «мой» или «my».


## Ответ 2

SELECT Название, Продолжительность
FROM Треки
WHERE Продолжительность = (SELECT MAX(Продолжительность) FROM Треки);

SELECT Название
FROM Треки
WHERE Продолжительность >= 3.5;

SELECT Название
FROM Сборники
WHERE Год_выпуска BETWEEN 2018 AND 2020;

SELECT Имя
FROM Исполнители
WHERE Имя NOT LIKE '% %';

SELECT Название
FROM Треки
WHERE Название LIKE '%мой%' OR Название LIKE '%my%';


## Задание 3

Написать SELECT-запросы, которые выведут информацию согласно инструкциям ниже.

Внимание: результаты запросов не должны быть пустыми, при необходимости добавьте данные в таблицы.

1. Количество исполнителей в каждом жанре.
2. Количество треков, вошедших в альбомы 2019–2020 годов.
3. Средняя продолжительность треков по каждому альбому.
4. Все исполнители, которые не выпустили альбомы в 2020 году.
5. Названия сборников, в которых присутствует конкретный исполнитель (выберите его сами).

## Ответ 3

SELECT Жанры.Название AS Жанр, COUNT(*) AS Количество_исполнителей
FROM Жанры
LEFT JOIN Исполнители ON Жанры.Идентификатор = Исполнители.Идентификатор_жанра
GROUP BY Жанры.Название;

SELECT COUNT(*) AS Количество_треков
FROM Треки
JOIN Альбомы ON Треки.Идентификатор_альбома = Альбомы.Идентификатор
WHERE Альбомы.Год_выпуска BETWEEN 2019 AND 2020;

SELECT Альбомы.Название AS Название_альбома, AVG(Треки.Продолжительность) AS Средняя_продолжительность
FROM Треки
JOIN Альбомы ON Треки.Идентификатор_альбома = Альбомы.Идентификатор
GROUP BY Альбомы.Название;

SELECT Исполнители.Имя
FROM Исполнители
LEFT JOIN Альбомы ON Исполнители.Идентификатор = Альбомы.Идентификатор_исполнителя
WHERE YEAR(Альбомы.Год_выпуска) <> 2020 OR Альбомы.Год_выпуска IS NULL;

SELECT Сборники.Название
FROM Сборники
JOIN Сборники_Треки ON Сборники.Идентификатор = Сборники_Треки.Идентификатор_сборника
JOIN Треки ON Сборники_Треки.Идентификатор_трека = Треки.Идентификатор
WHERE Треки.Идентификатор_исполнителя = 1;


---

Результатом работы будет три файла в формате `.sql`:

- с INSERT-запросами (задание 1),
- с SELECT-запросами (задание 2,3,4),
- с CREATE-запросами (из предыдущей домашней работы).
